server:
  port: 8081

spring:
  application:
    name: elearning-gateway-service

  data:
    redis:
      host: localhost
      port: 6379

  codec:
    max-in-memory-size: 2MB

  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: ${GATEWAY_JWKS_URI:https://auth.example.com/.well-known/jwks.json}
          issuer-uri: ${GATEWAY_ISSUER:https://auth.example.com/}

  cloud:
    gateway:
      preserve-host-header: true

      httpclient:
        connect-timeout: 10000
        response-timeout: 10000

      default-filters:
        - RemoveRequestHeader=Cookie
        - RemoveRequestHeader=Set-Cookie
        - RemoveRequestHeader=X-Forwarded-For
        - AddResponseHeader=X-Gateway, SpringCloudGateway
        - AddRequestHeader=X-Request-Time, 0

      routes:
        # MAIN SERVICE
        - id: main-service
          uri: http://127.0.0.1:8085
          predicates:
            - Path=/main/**
          filters:
            - StripPrefix=0
            - SetRequestHeader=Host, localhost:8085
            - name: RequestRateLimiter
              args:
                key-resolver: "#{@userKeyResolver}"
                redis-rate-limiter.replenishRate: 5
                redis-rate-limiter.burstCapacity: 20

        # COURSE SERVICE
        - id: course-service
          uri: ${COURSE_SERVICE_URL:http://course-service:8082}
          predicates:
            - Path=/course/**
          filters:
            - StripPrefix=1

        # PAYMENT SERVICE
        - id: payment-service
          uri: ${PAYMENT_SERVICE_URL:http://payment-service:8084}
          predicates:
            - Path=/payment/**
          filters:
            - StripPrefix=1

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus

logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: INFO
    org.springframework.security: INFO
    org.springframework.data.redis: DEBUG
    org.springframework.cloud.gateway.filter.ratelimit: DEBUG
